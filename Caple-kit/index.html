<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SGGXP5M8PZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SGGXP5M8PZ');
</script>
    <script>
    gtag('event', 'conversion', {
        'send_to': 'AW-17064012339/7IZfCOjSm_UaELPU4Mg_',
        'transaction_id': ''
    });
</script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SGGXP5M8PZ"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-SGGXP5M8PZ');
</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>عرض خاص من نور ستور: توصيل مجاني لعلبة الوصلات السحرية!</title>
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #e74c3c; 
            --background-color: #ecf0f1;
            --text-color: #333;
            --white-color: #ffffff;
            --success-color: #2ecc71;
            --error-color: #e74c3c;
        }

        body {
            font-family: 'Cairo', 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            scroll-behavior: smooth;
        }

        .container { max-width: 960px; margin: 0 auto; padding: 20px; }
        header { background-color: var(--primary-color); color: var(--white-color); padding: 40px 20px; text-align: center; }
        header h1 { margin: 0 0 15px; font-size: 2.5em; font-weight: 700; }
        .promo-text { font-size: 1.3em; margin-top: 25px; margin-bottom: 15px; font-weight: bold; color: #f1c40f; }
        
        .rating { margin-top: 15px; font-size: 1.2em; color: #f1c40f; }
        .rating-text { color: var(--white-color); opacity: 0.9; font-size: 0.9em; display: block; margin-top: 5px; }

        .sales-stat {
            display: inline-block;
            margin-top: 20px;
            background-color: rgba(46, 204, 113, 0.15);
            color: var(--success-color);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2em;
        }

        .price-container {
            margin: 25px auto 0;
            padding: 15px;
            border-radius: 10px;
            display: inline-block;
            border: 2px dashed #f1c40f;
        }
        .price-box {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        .new-price {
            font-size: 2.8em;
            font-weight: 700;
            color: var(--white-color);
        }
        .old-price {
            font-size: 1.8em;
            color: #ccc;
            text-decoration: line-through;
            opacity: 0.7;
        }
        .savings {
            margin-top: 5px;
            font-size: 1.2em;
            font-weight: bold;
            color: var(--success-color);
        }
        #order-section .new-price { color: var(--primary-color); }
        #order-section .old-price { color: #888; }
        #order-section .price-container { border: none; }
        #order-section .savings { color: var(--secondary-color); }

        #countdown-timer { display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 20px; direction: ltr; flex-direction: row-reverse; }
        .timer-box { background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 8px; min-width: 80px; text-align: center; }
        .timer-box span { display: block; font-size: 2.5em; font-weight: bold; color: var(--white-color); }
        .timer-box .timer-label { font-size: 0.9em; color: var(--background-color); opacity: 0.8; direction: rtl; }
        #offer-expired { font-size: 1.5em; font-weight: bold; color: var(--secondary-color); display: none; }

        .cta-button { display: inline-block; background-color: var(--success-color); color: var(--white-color); padding: 15px 35px; text-decoration: none; font-size: 1.3em; font-weight: bold; border-radius: 8px; margin-top: 25px; transition: background-color 0.3s ease, transform 0.2s ease; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border: none; cursor: pointer; font-family: 'Cairo', sans-serif; }
        .cta-button:hover { background-color: #27ae60; transform: scale(1.05); }
        .cta-button:disabled { background-color: #aaa; cursor: not-allowed; }

        #floating-cta-button { position: fixed; bottom: 20px; right: 20px; z-index: 1000; margin-top: 0; box-shadow: 0 5px 15px rgba(0,0,0,0.3); opacity: 0; transform: translateY(100px); transition: opacity 0.4s ease, transform 0.4s ease; pointer-events: none; }
        #floating-cta-button.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }

        .section { padding: 60px 20px; text-align: center; }
        .section-light { background-color: var(--white-color); }
        .section h2 { font-size: 2.5em; margin-bottom: 40px; color: var(--primary-color); }

        .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; text-align: right; }
        .feature { background: var(--white-color); padding: 25px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.08); }
        .feature h3 { font-size: 1.4em; margin-bottom: 10px; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .gallery-grid img { width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: transform 0.3s ease; cursor: pointer; }
        .gallery-grid img:hover { transform: scale(1.05); }
        .testimonials q { font-size: 1.2em; font-style: italic; display: block; margin-bottom: 10px; line-height: 1.8; }
        .testimonials footer { font-weight: bold; color: #3498db; }
        .faq { text-align: right; max-width: 700px; margin: 0 auto; }
        .faq details { background: var(--white-color); padding: 15px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); cursor: pointer; }
        .faq summary { font-weight: bold; font-size: 1.1em; }

        .lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); z-index: 10000; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; overflow: hidden; }
        .lightbox.active { opacity: 1; pointer-events: auto; }
        .lightbox-content { max-width: 90%; max-height: 80%; box-shadow: 0 0 25px rgba(0,0,0,0.8); transition: transform 0.2s ease; cursor: grab; }
        .lightbox-content:active { cursor: grabbing; }
        .lightbox-close { position: absolute; top: 20px; right: 30px; font-size: 45px; color: white; cursor: pointer; z-index: 10002; }
        .lightbox-nav { position: absolute; top: 50%; transform: translateY(-50%); font-size: 50px; color: white; cursor: pointer; user-select: none; z-index: 10002; }
        .lightbox-prev { left: 30px; }
        .lightbox-next { right: 30px; }
        .lightbox-zoom-controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: rgba(0,0,0,0.5); border-radius: 20px; padding: 5px; display: flex; gap: 10px; z-index: 10002; }
        .lightbox-zoom-btn { font-size: 24px; color: white; cursor: pointer; width: 30px; height: 30px; display: flex; justify-content: center; align-items: center; }

        #order-section { padding-bottom: 100px; }
        .order-form { max-width: 600px; margin: 40px auto 0; background: #f9f9f9; padding: 30px 40px; border-radius: 8px; border: 1px solid #ddd; text-align: right; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary-color); font-size: 1.1em; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; font-family: 'Cairo', sans-serif; box-sizing: border-box; text-align: right; }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .order-form .cta-button { width: 100%; margin-top: 10px; }
        #phone-error { color: var(--error-color); font-weight: bold; font-size: 0.9em; min-height: 1em; margin-top: 5px; }

        #form-response { margin-top: 15px; font-size: 1.2em; font-weight: bold; display: none; padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        #form-response.success { background-color: #d4edda; color: #155724; }
        #form-response.error { background-color: #f8d7da; color: #721c24; }


        @media (max-width: 768px) {
            .container { padding: 15px; }
            header { padding: 20px 15px; }
            header h1 { font-size: 1.8em; margin-bottom: 10px; }
            
            .social-proof-box { display: flex; justify-content: center; align-items: center; gap: 15px; flex-wrap: wrap; margin-top: 15px; }
            .social-proof-box .rating, .social-proof-box .sales-stat { margin-top: 0; }
            .social-proof-box .rating { font-size: 1em; }
            .social-proof-box .rating-text { font-size: 0.8em; }
            .social-proof-box .sales-stat { font-size: 0.9em; padding: 6px 12px; }
            
            .promo-text { font-size: 1.1em; margin-top: 15px; margin-bottom: 10px; }
            
            .price-container { display: flex; flex-wrap: wrap; justify-content: center; align-items: baseline; gap: 10px 15px; border: none; padding: 0; margin-top: 15px; }
            .new-price { font-size: 2.2em; }
            .old-price { font-size: 1.4em; }
            .savings { margin-top: 0; font-size: 1em; padding: 4px 10px; border-radius: 5px; background-color: var(--secondary-color); color: var(--white-color); }

            #countdown-timer { margin-top: 15px; }
            .timer-box { min-width: 65px; padding: 10px; }
            .timer-box span { font-size: 1.8em; }
            .timer-box .timer-label { font-size: 0.8em; }
            
            .cta-button { font-size: 1.15em; padding: 15px 25px; margin-top: 15px; width: 90%; box-sizing: border-box; }

            #floating-cta-button { right: 15px; bottom: 90px; }
            .section { padding: 40px 15px; }
            .section h2 { font-size: 2em; }
            .order-form { padding: 20px; }
            .lightbox-nav { font-size: 40px; }
            .lightbox-prev { left: 15px; }
            .lightbox-next { right: 15px; }
        }
    </style>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

    <header>
        <div class="container">
            <h1>علبة الوصلات السحرية من نور ستور</h1>
            <div class="social-proof-box">
                <div class="rating">
                    تقييم 4.5 / 5 نجوم ★★★★☆
                    <span class="rating-text">(أكثر من 150 تقييم)</span>
                </div>
                <div class="sales-stat">
                    🔥 تم بيع أكثر من 5000 قطعة!
                </div>
            </div>
            <div class="price-container">
                <span class="new-price">249 جنيه</span>
                <span class="old-price">400 جنيه</span>
                <span class="savings">وفر 151 جنيه!</span>
            </div>
            <p class="promo-text">اطلب خلال الوقت المتبقي واحصل على توصيل مجاني تمامًا!</p>
            <div id="countdown-timer">
                <div class="timer-box"><span id="hours">01</span><div class="timer-label">ساعة</div></div>
                <div class="timer-box"><span id="minutes">00</span><div class="timer-label">دقيقة</div></div>
                <div class="timer-box"><span id="seconds">00</span><div class="timer-label">ثانية</div></div>
            </div>
            <div id="offer-expired">انتهى عرض التوصيل المجاني!</div>
            <a href="#order-form" id="main-cta-button" class="cta-button">اطلب علبة الوصلات السحرية الآن بـ 249 جنيه!</a>
        </div>
    </header>

    <main>
        <section id="features" class="section section-light">
            <div class="container">
                <h2>ليه تختار علبة الوصلات السحرية من نور ستور؟</h2>
                <div class="features-grid">
                    <div class="feature">
                        <h3>شحن ونقل بيانات آمن وسريع</h3>
                        <p>تجمع الأداة الذكية الصغيرة بين أربع مخارج متعددة الاستخدامات للشحن والتحويل ونقل البيانات بكل سهولة. تحتوي على كابل USB-C مدمج مع 3 محوّلات (USB-A، Micro USB، Lightning) لتغطي كافة احتياجاتك سواء كنت تستخدم أجهزة أندرويد أو iOS.</p>
                    </div>
                    <div class="feature">
                        <h3>حل متكامل لمشاكل الشحن</h3>
                        <p>وداعًا لفوضى الكابلات المتشابكة والبحث عن الوصلة المناسبة. صندوق التخزين المحمول يحتوي على كل ما تحتاجه لشحن ومزامنة جهازك، مع تصميم يحافظ على ترتيب الكابلات ويحمي أطرافها من التلف أو التشابك داخل حقيبتك.</p>
                    </div>
                    <div class="feature">
                        <h3>جودة عالية وخامات متينة</h3>
                        <p>جميع المحوّلات مصنوعة من خليط الألومنيوم المقاوم للخدوش، ويتميز السلك الداخلي بسُمك أكبر من الكابلات التقليدية، ما يمنحك سرعة شحن ونقل بيانات أعلى لجميع أجهزتك: موبايل، تابلت، أو لابتوب.</p>
                    </div>
                    <div class="feature">
                        <h3>تصميم مدمج وسهل الحمل</h3>
                        <p>بحجمه الصغير (3.2 × 0.4 بوصة)، يمكنك وضع مجموعة الكابلات هذه بسهولة في جيبك، محفظتك، أو شنطة يدك، لتكون دائمًا معك أثناء التنقل.</p>
                    </div>
                    <div class="feature">
                        <h3>منظّم تخزين ذكي ومتعدد الاستخدامات</h3>
                        <p>يحتوي الطقم على 3 فتحات مخصصة لتخزين شرائح الاتصال: فتحتان لشرائح Nano وواحدة لشرائح Micro، إلى جانب أداة إخراج الشريحة. كما يمكن استخدام العلبة نفسها كحامل موبايل مريح أثناء مشاهدة الفيديوهات أو المكالمات.</p>
                    </div>
                    <div class="feature">
                        <h3>مثالي للسفر والتنقل</h3>
                        <p>لا داعي لحمل كابلات ومحولات متعددة. علبة الوصلات السحرية دي هي كل اللي هتحتاجه عشان تفضل متوصل وأنت مسافر أو في أي مكان.</p>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="gallery" class="section">
            <div class="container">
                <h2>شاهد علبة الوصلات السحرية عن قرب</h2>
                <div class="gallery-grid">
                    <img src="https://assets.wuiltstore.com/cmcfdyk2a02ln01jb25cv84tz_61Ayk50i-cL._AC_SL1200_.jpg" alt="علبة الوصلات السحرية">
                    <img src="https://assets.wuiltstore.com/cmcfh071902m701jb9vpehl52_51NKMnDDPgL._AC_SL1000_.jpg" alt="طقم شحن متعدد الاستخدامات">
                    <img src="https://assets.wuiltstore.com/cmcfh07lj02m801jbcc5n4y0a_51R9h9Fa6YL._AC_SL1000_.jpg" alt="تفاصيل المحولات في الصندوق">
                    <img src="https://assets.wuiltstore.com/cmcfh082702m901jb6dk47kaj_51NiLWCBSNL._AC_SL1000_.jpg" alt="صندوق الشحن مع الكابلات">
                    <img src="https://assets.wuiltstore.com/cmcfh08if02ma01jbh8dc4v82_61-bt7K5aTL._AC_SL1000_.jpg" alt="طريقة استخدام حامل الهاتف">
                    <img src="https://assets.wuiltstore.com/cmcfh091j02mb01jb4m1f0mh0_61d_gjkwGGL._AC_SL1000_.jpg" alt="الطقم مدمج على مكتب">
                    <img src="https://assets.wuiltstore.com/cmcfh09hx02mc01jbftt21qgk_61zOkDPSI1L._AC_SL1000_.jpg" alt="الطقم في اليد">
                </div>
            </div>
        </section>

        <section id="testimonials" class="section section-light">
            <div class="container">
                <h2>شوف رأي عملائنا في علبة الوصلات السحرية</h2>
                <div class="testimonials">
                    <q>ده كنز بجد للسفر! بدل ما أشيل 100 كابل وشاحن، العلبة دي فيها كل حاجة، حجمها صغير وجودتها ممتازة. وفرت عليا كتير لما جبتها بـ 249 جنيه بدل 400!</q>
                    <footer>- مريم، القاهرة</footer>
                </div>
                <hr style="width:50%; margin: 30px auto; border-color: #ddd;">
                <div class="testimonials">
                    <q>أنا كنت دايماً بتوه في الكابلات، بس العلبة السحرية دي منظمة جداً وخلتني أقدر أشحن أي جهاز عندي. خصوصاً إن فيها مكان شرايح الخطوط، فكرة عبقرية.</q>
                    <footer>- أحمد، الإسكندرية</footer>
                </div>
                <hr style="width:50%; margin: 30px auto; border-color: #ddd;">
                <div class="testimonials">
                    <q>جودة الخامات محترمة جداً وسرعة الشحن رهيبة. استخدمتها كذا مرة ومفيش أي مشاكل. تستاهل كل جنيه دفعته فيها، خصوصاً بالسعر ده كانت صفقة ممتازة!</q>
                    <footer>- فاطمة، الجيزة</footer>
                </div>
            </div>
        </section>
        <section id="faq" class="section">
            <div class="container"><h2>أسئلة شائعة</h2><div class="faq"><details><summary>ما هي الأجهزة التي تدعمها علبة الوصلات السحرية؟</summary><p>تدعم علبة الوصلات السحرية جميع الأجهزة التي تستخدم مخارج USB-C، USB-A، Micro USB، وLightning (لأجهزة iOS). سواء كان موبايل، تابلت، أو لابتوب.</p></details><details><summary>هل تدعم الشحن السريع؟</summary><p>نعم، بفضل الخامات عالية الجودة والسلك الداخلي السميك، توفر علبة الوصلات السحرية شحنًا آمنًا وسريعًا لأجهزتك.</p></details><details><summary>هل يمكنني استخدامها لنقل البيانات؟</summary><p>بالتأكيد، علبة الوصلات السحرية تدعم نقل البيانات بسرعة عالية بين أجهزتك المختلفة.</p></details><details><summary>ما هي وظيفة فتحات كروت الذاكرة؟</summary><p>علبة الوصلات السحرية مصممة لتخزين شرائح الاتصال (SIM cards) وليس كروت الذاكرة. تحتوي على فتحتين لشرائح Nano وواحدة لشرائح Micro، بالإضافة لأداة إخراج الشريحة.</p></details><details><summary>هل يمكن استخدام العلبة كحامل هاتف؟</summary><p>نعم، العلبة مصممة بشكل مبتكر لتستخدم كحامل للهاتف، مما يجعله مثاليًا لمشاهدة الفيديوهات أو إجراء المكالمات.</p></details></div></div>
        </section>
        
        <section id="order-section" class="section-light">
            <div class="container">
                <h2 id="form-title">اطلب علبة الوصلات السحرية الآن واستفد من التوصيل المجاني!</h2>
                <div class="price-container">
                    <div class="price-box">
                        <span class="new-price">249 جنيه</span>
                        <span class="old-price">400 جنيه</span>
                    </div>
                </div>
                <p style="margin-top: 25px;">املأ النموذج التالي لتأكيد طلبك</p>
                <form class="order-form" id="order-form">
                    <div id="form-response"></div>
                    <div class="form-group"><label for="name">الاسم بالكامل</label><input type="text" id="name" name="name" placeholder="مثال: محمد أحمد" required></div>
                    <div class="form-group"><label for="phone">رقم الهاتف (ضروري للتوصيل)</label><input type="tel" id="phone" name="phone" placeholder="مثال: 01012345678" required style="direction: ltr; text-align: right;"><div id="phone-error"></div></div>
                    <div class="form-group"><label for="address">العنوان بالتفصيل</label><input type="text" id="address" name="address" placeholder="المحافظة - المدينة - الحي - اسم الشارع ورقم المبنى" required></div>
                    <div class="form-group"><label for="quantity">الكمية</label><input type="number" id="quantity" name="quantity" value="1" min="1" required style="direction: ltr; text-align: right;"></div>
                    <div class="form-group"><label for="notes">ملاحظات (اختياري)</label><textarea id="notes" name="notes" placeholder="هل لديك أي تعليمات خاصة بالتوصيل؟ اكتبها هنا."></textarea></div>
                    <button type="submit" class="cta-button" id="submit-button">تأكيد الطلب الآن</button>
                </form>
            </div>
        </section>
    </main>
    
    <a href="#order-form" id="floating-cta-button" class="cta-button">اطلب علبة الوصلات السحرية الآن بتوصيل مجاني</a>

    <div class="lightbox" id="lightbox">
        <span class="lightbox-close">×</span>
        <span class="lightbox-nav lightbox-prev">❮</span>
        <img src="" class="lightbox-content" id="lightbox-img">
        <span class="lightbox-nav lightbox-next">❯</span>
        <div class="lightbox-zoom-controls">
            <span class="lightbox-zoom-btn" id="zoom-in">+</span>
            <span class="lightbox-zoom-btn" id="zoom-out">-</span>
        </div>
    </div>

    <script>
        function initializeApp() {
            function setupTimer() {
                const duration = 60 * 60;  
                let timer = duration;  
                let intervalId;
                const elements = {  
                    timerDisplay: document.getElementById('countdown-timer'),  
                    hours: document.getElementById('hours'),  
                    minutes: document.getElementById('minutes'),  
                    seconds: document.getElementById('seconds'),  
                    mainCtaButton: document.getElementById('main-cta-button'),  
                    offerExpiredMessage: document.getElementById('offer-expired'),  
                    formTitle: document.getElementById('form-title'),  
                    floatingBtn: document.getElementById('floating-cta-button')  
                };
                function updateTimer() {
                    if (timer < 0) {
                        clearInterval(intervalId);
                        if(elements.timerDisplay) elements.timerDisplay.style.display = 'none';
                        if(elements.offerExpiredMessage) elements.offerExpiredMessage.style.display = 'block';
                        if(elements.mainCtaButton) elements.mainCtaButton.textContent = 'اطلب المنتج الآن';
                        if(elements.formTitle) elements.formTitle.textContent = 'اطلب المنتج الآن';
                        if(elements.floatingBtn) elements.floatingBtn.textContent = 'اطلب الآن';
                        return;
                    }
                    let h = Math.floor(timer / 3600), m = Math.floor((timer % 3600) / 60), s = timer % 60;
                    if(elements.hours) elements.hours.textContent = h < 10 ? '0' + h : h;
                    if(elements.minutes) elements.minutes.textContent = m < 10 ? '0' + m : m;
                    if(elements.seconds) elements.seconds.textContent = s < 10 ? '0' + s : s;
                    timer--;
                }
                updateTimer();  
                intervalId = setInterval(updateTimer, 1000);
            }
            
            function setupFloatingButton() {
                const floatingButton = document.getElementById('floating-cta-button');
                const orderForm = document.getElementById('order-form');
                const mainCtaButton = document.getElementById('main-cta-button');

                if(!floatingButton || !orderForm || !mainCtaButton) return;

                // Function to send begin_checkout event only once per session
                function sendBeginCheckoutEvent() {
                    if (!sessionStorage.getItem('magic_cable_box_begin_checkout_sent')) {
                        gtag('event', 'begin_checkout', {
                            items: [{
                                item_id: 'magic_cable_box',
                                item_name: 'علبة الوصلات السحرية',
                                price: 249, // Fixed price for this product
                                quantity: 1 // Assuming 1 when initiating checkout
                            }]
                        });
                        sessionStorage.setItem('magic_cable_box_begin_checkout_sent', 'true');
                    }
                }

                // Add begin_checkout event listener to main CTA button
                mainCtaButton.addEventListener('click', sendBeginCheckoutEvent);

                // Add begin_checkout event listener to floating CTA button
                floatingButton.addEventListener('click', sendBeginCheckoutEvent);

                window.addEventListener('scroll', function() {
                    const mainButtonRect = mainCtaButton.getBoundingClientRect();
                    const orderFormRect = orderForm.getBoundingClientRect();
                    
                    const shouldShow = mainButtonRect.bottom < 0;
                    const shouldHide = orderFormRect.top < window.innerHeight;

                    if (shouldShow && !shouldHide) {  
                        floatingButton.classList.add('visible');  
                    } else {  
                        floatingButton.classList.remove('visible');  
                    }
                });
            }

            function setupFormValidation() {
                const orderForm = document.getElementById('order-form');
                if (!orderForm) return;

                const phoneInput = document.getElementById('phone');
                const phoneError = document.getElementById('phone-error');
                const submitButton = document.getElementById('submit-button');
                const formResponse = document.getElementById('form-response');
                const quantityInput = document.getElementById('quantity'); // Get quantity input

                // ====> الخطوة الأهم: الصق رابط الـ Web App الخاص بك هنا <====
                const scriptURL = 'https://script.google.com/macros/s/AKfycbyjycnSi5kr9pot5H9lrKrd11Hx_i6o9GIkq9mF71aqyIIolweQz0lVDBfxL1AwJLwAmQ/exec';
                // ==========================================================

                phoneInput.addEventListener('input', function(e) {  
                    const sanitizedValue = e.target.value.replace(/[^0-9\u0660-\u0669+]/g, '');  
                    if (e.target.value !== sanitizedValue) { e.target.value = sanitizedValue; }  
                });

                orderForm.addEventListener('submit', function(event) {
                    event.preventDefault();  
                    phoneError.textContent = '';
                    
                    let phoneNumber = phoneInput.value.replace(/[\u0660-\u0669\u06F0-\u06F9]/g, d => d.charCodeAt(0) & 0x0F).replace(/\s/g, '');
                    if (phoneNumber.startsWith('+2')) phoneNumber = phoneNumber.substring(2);
                    if (phoneNumber.length !== 11) {  
                        phoneError.textContent = 'الرقم يجب أن يتكون من 11 رقمًا بالضبط.';  
                        return;  
                    }
                    const validPrefixes = ['010', '011', '012', '015'];
                    if (!validPrefixes.some(prefix => phoneNumber.startsWith(prefix))) {  
                        phoneError.textContent = 'يجب أن يبدأ الرقم بـ 010, 011, 012, أو 015.';  
                        return;  
                    }

                    // ---------- START: الكود المعدل لتحسين تجربة المستخدم ----------

                    // 1. تجهيز بيانات النموذج للإرسال لاحقاً
                    const formData = new FormData(orderForm);

                    // 2. إظهار رسالة النجاح وإعادة تعيين النموذج على الفور
                    formResponse.textContent = '✅ تم استلام طلبك بنجاح! سنتصل بك للتأكيد.';
                    formResponse.className = 'success';
                    formResponse.style.display = 'block';
                    submitButton.disabled = true;
                    submitButton.textContent = 'تم الإرسال بنجاح!';
                    
                    // --- Google Analytics Purchase Event ---
                    const rawQuantity = quantityInput.value;
                    const englishQuantityString = rawQuantity.replace(/[\u0660-\u0669]/g, d => d.charCodeAt(0) - 0x0660) // Eastern Arabic numerals
                                                              .replace(/[\u06F0-\u06F9]/g, d => d.charCodeAt(0) - 0x06F0); // Extended Arabic numerals (Persian/Urdu)
                    const itemQuantity = parseInt(englishQuantityString);

                    const itemPrice = 249; // Fixed price per unit - UPDATED TO 249
                    const transactionId = 'T_' + Date.now() + '_' + Math.floor(Math.random() * 1000000); // Unique transaction ID

                    gtag('event', 'purchase', {
                        transaction_id: transactionId,
                        value: (itemQuantity * itemPrice),
                        currency: 'EGP',
                        items: [{
                            item_id: 'magic_cable_box', 
                            item_name: 'علبة الوصلات السحرية',
                            price: itemPrice,
                            quantity: itemQuantity
                        }]
                    });
                    // --- End Google Analytics Purchase Event ---

                    orderForm.reset(); // إفراغ حقول النموذج
                    phoneError.textContent = ''; // إفراغ رسالة الخطأ إن وجدت
                    formResponse.scrollIntoView({ behavior: 'smooth', block: 'center' }); // تمرير الشاشة لرسالة النجاح

                    // 3. إرسال البيانات في الخلفية. المستخدم ليس بحاجة لانتظار هذه الخطوة
                    fetch(scriptURL, { method: 'POST', body: formData})
                        .catch(error => {
                            // هذه الرسالة ستظهر في الكونسول فقط للمطورين في حال حدوث خطأ
                            console.error('!فشل إرسال النموذج إلى جوجل شيت', error.message);
                        });

                    // 4. إعادة تفعيل الزر بعد فترة قصيرة للسماح بالإرسال مرة أخرى إذا لزم الأمر
                    setTimeout(() => {
                        submitButton.disabled = false;
                        submitButton.textContent = 'تأكيد الطلب الآن';
                    }, 4000); // إعادة تفعيل الزر بعد 4 ثواني

                    // ---------- END: نهاية الكود المعدل ----------
                });
            }

            function setupLightbox() {
                const lightbox = document.getElementById('lightbox');  
                if (!lightbox) return;

                const lightboxImg = document.getElementById('lightbox-img'),  
                      galleryImages = document.querySelectorAll('.gallery-grid img'),  
                      closeBtn = document.querySelector('.lightbox-close'),  
                      prevBtn = document.querySelector('.lightbox-prev'),  
                      nextBtn = document.querySelector('.lightbox-next'),  
                      zoomInBtn = document.getElementById('zoom-in'),  
                      zoomOutBtn = document.getElementById('zoom-out');
                let currentIndex = 0, zoomLevel = 1;

                function applyZoom() { lightboxImg.style.transform = `scale(${zoomLevel})`; }
                function resetZoom() { zoomLevel = 1; applyZoom(); }
                function showLightbox(index) { currentIndex = index; lightboxImg.src = galleryImages[currentIndex].src; lightbox.classList.add('active'); resetZoom(); }
                function hideLightbox() { lightbox.classList.remove('active'); }
                function showNextImage() { currentIndex = (currentIndex + 1) % galleryImages.length; lightboxImg.src = galleryImages[currentIndex].src; resetZoom(); }
                function showPrevImage() { currentIndex = (currentIndex - 1 + galleryImages.length) % galleryImages.length; lightboxImg.src = galleryImages[currentIndex].src; resetZoom(); }
                
                galleryImages.forEach((img, index) => { img.addEventListener('click', () => showLightbox(index)); });
                closeBtn.addEventListener('click', hideLightbox);
                nextBtn.addEventListener('click', showNextImage);
                prevBtn.addEventListener('click', showPrevImage);
                zoomInBtn.addEventListener('click', () => { zoomLevel += 0.2; applyZoom(); });
                zoomOutBtn.addEventListener('click', () => { if (zoomLevel > 0.5) { zoomLevel -= 0.2; applyZoom(); } });
                lightboxImg.addEventListener('wheel', (e) => { e.preventDefault(); if (e.deltaY < 0) { zoomLevel += 0.1; } else { if (zoomLevel > 0.5) zoomLevel -= 0.1; } applyZoom(); });
                lightbox.addEventListener('click', (e) => { if (e.target === lightbox) hideLightbox(); });
                document.addEventListener('keydown', (e) => {
                    if (lightbox.classList.contains('active')) {
                        if (e.key === 'ArrowRight') showNextImage();
                        else if (e.key === 'ArrowLeft') showPrevImage();
                        else if (e.key === 'Escape') hideLightbox();
                    }
                });
            }

            // Now, run all the functions.
            setupTimer();
            setupFloatingButton();
            setupFormValidation();
            setupLightbox();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>
